{
  "c54e70bc-12f9-43ee-9fec-4eae933668c3": {
    "policy_id": "c54e70bc-12f9-43ee-9fec-4eae933668c3",
    "policy_name": "Page 61 1.2.3 (L1) Ensure 'Allow Administrator account lockout' is set to",
    "registry_path": "N/A:\\N/A",
    "registry_hive": "N/A",
    "registry_key": "N/A",
    "registry_value_name": "N/A",
    "registry_value_type": "N/A",
    "enabled_value": "1",
    "disabled_value": "0",
    "gpo_path": "Computer Configuration\\Policies\\Windows Settings\\Security Settings\\Local Policies\\Security Options",
    "gpo_setting": "Accounts: Allow Administrator account lockout",
    "secedit_section": "[Security Options]",
    "secedit_setting": "AllowAdministratorLockout",
    "powershell_command": "$tempInfPath = Join-Path -Path $env:TEMP -ChildPath \"AdminLockout_Enabled.inf\"\n    $infContent = @'\n[Unicode]\nUnicode=yes\n[Version]\nsignature=\"$CHICAGO$\"\nRevision=1\n[Security Options]\nAllowAdministratorLockout = 1\n'@\n\n    # Create the .inf file with the policy setting\n    Set-Content -Path $tempInfPath -Value $infContent -Encoding Unicode\n\n    # Apply the security policy using secedit\n    secedit /configure /db \"$env:SystemRoot\\Security\\database\\scesrv.sdb\" /cfg \"$tempInfPath\" /overwrite /areas SECURITYPOLICY\n\n    # Clean up the temporary .inf file\n    Remove-Item -Path $tempInfPath -Force -ErrorAction SilentlyContinue\n\n    Write-Host \"Policy 'Allow Administrator account lockout' set to Enabled via secedit. A 'gpupdate /force' and possibly a reboot/logoff might be required for full effect.\"",
    "verification_command": "$regPath = \"HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Lsa\"\n$valueName = \"AdminAccountLockout\"\n\n# Attempt to retrieve the registry value where this policy's effective state is stored\n$currentValue = Get-ItemPropertyValue -Path $regPath -Name $valueName -ErrorAction SilentlyContinue\n\nif ($currentValue -eq $null) {\n    Write-Host \"Policy setting 'Allow Administrator account lockout' (AdminAccountLockout) is not found or not yet applied. This might indicate the OS is not patched (KB5020282) or the policy has not been configured/propagated.\" -ForegroundColor Yellow\n} elseif ($currentValue -eq 1) {\n    Write-Host \"Policy 'Allow Administrator account lockout' is correctly set to Enabled (Current value: $currentValue).\" -ForegroundColor Green\n} else {\n    Write-Host \"Policy 'Allow Administrator account lockout' is set to Disabled (Current value: $currentValue). Remediation is required.\" -ForegroundColor Red\n}",
    "remediation_notes": "This setting applies only to OSes patched as of October 11, 2022 (see MS KB5020282). Ensure the system is updated to a version that supports this functionality before applying the policy. If the built-in Administrator account is frequently used for interactive logons, ensure robust monitoring and management practices are in place (e.g., account lockout thresholds, short lockout durations, automated alerts) to prevent accidental lockout, which could lead to denial of service. Consider renaming the Administrator account to further obscure it from attackers. After applying the policy, run 'gpupdate /force' to ensure propagation.",
    "requires_reboot": false,
    "risk_level": "Medium"
  },
  "bdaa0fa3-6466-4722-a103-a9c987d2cc9d": {
    "policy_id": "bdaa0fa3-6466-4722-a103-a9c987d2cc9d",
    "policy_name": "Page 63 1.2.4 (L1) Ensure 'Reset account lockout counter after' is set to",
    "registry_path": "N/A:\\N/A",
    "registry_hive": "N/A",
    "registry_key": "N/A",
    "registry_value_name": "N/A",
    "registry_value_type": "N/A",
    "enabled_value": "15",
    "disabled_value": "0",
    "gpo_path": "Computer Configuration\\Policies\\Windows Settings\\Security Settings\\Account Policies\\Account Lockout Policy",
    "gpo_setting": "Reset account lockout counter after",
    "secedit_section": "[System Access]",
    "secedit_setting": "ResetLockoutCount",
    "powershell_command": "net accounts /lockoutreset:15",
    "verification_command": "(net accounts | Select-String -Pattern 'Lockout reset in:').ToString().Split(':')[1].Trim()",
    "remediation_notes": "This policy controls how long it takes for the account lockout counter to reset to zero after a specified number of failed logon attempts. For domain user accounts, this policy must be applied via the Default Domain Policy GPO. If configured in another GPO, it will only affect local user accounts on the computers that receive the GPO. Custom exceptions for specific domain users/groups can be achieved using Password Settings Objects (PSOs) in Active Directory Administrative Center. The recommended setting is 15 minutes or more. Setting it to 0 or 'Not Defined' means the counter never resets automatically, requiring manual unlocking of accounts and making the system vulnerable to Denial-of-Service (DoS) attacks where all accounts could be locked out indefinitely by an attacker.",
    "requires_reboot": false,
    "risk_level": "Medium"
  },
  "82e32be3-cc8f-4d45-b353-0197177dd2f2": {
    "policy_id": "82e32be3-cc8f-4d45-b353-0197177dd2f2",
    "policy_name": "Page 39 1.1.1 (L1) Ensure 'Enforce password history' is set to '24 or more",
    "registry_path": "N/A:\\N/A",
    "registry_hive": "N/A",
    "registry_key": "N/A",
    "registry_value_name": "N/A",
    "registry_value_type": "N/A",
    "enabled_value": "24",
    "disabled_value": "0",
    "gpo_path": "Computer Configuration\\Windows Settings\\Security Settings\\Account Policies\\Password Policy",
    "gpo_setting": "Enforce password history",
    "secedit_section": "[System Access]",
    "secedit_setting": "PasswordHistorySize",
    "powershell_command": "net accounts /uniquepw:24",
    "verification_command": "(net accounts | Select-String -Pattern 'Minimum password history').ToString().Split(':')[1].Trim()",
    "remediation_notes": "For domain-joined systems, this policy should be configured in the Default Domain Policy GPO. For standalone systems or local user accounts, `net accounts` or the Local Security Policy editor (which writes to the secedit database) is used. The maximum value supported by Microsoft is 24. Setting this value to '0' disables password history.",
    "requires_reboot": false,
    "risk_level": "High"
  },
  "2d46374f-ac6a-4e29-97b5-f696d6ca9a4a": {
    "policy_id": "2d46374f-ac6a-4e29-97b5-f696d6ca9a4a",
    "policy_name": "Page 3 1.1.3 (L1) Ensure 'Minimum password age' is set to '1 or more day(s)' (Automated)  ..............  44",
    "registry_path": "N/A:\\N/A",
    "registry_hive": "N/A",
    "registry_key": "N/A",
    "registry_value_name": "N/A",
    "registry_value_type": "N/A",
    "enabled_value": "1",
    "disabled_value": "0",
    "gpo_path": "Computer Configuration\\Windows Settings\\Security Settings\\Account Policies\\Password Policy",
    "gpo_setting": "Minimum password age",
    "secedit_section": "[System Access]",
    "secedit_setting": "MinimumPasswordAge",
    "powershell_command": "net accounts /minpwage:1",
    "verification_command": "$minPwAge = (net accounts | Select-String \"Minimum password age\").ToString() | ForEach-Object { if ($_ -match 'Minimum password age:\\s+(\\d+)') { $Matches[1] } else { '' } }; if ($minPwAge -and ([int]$minPwAge -ge 1)) { Write-Host \"Minimum password age is set to $minPwAge day(s), which is compliant.\" } else { Write-Host \"Minimum password age is set to $minPwAge day(s) or not found, which is NOT compliant.\" }",
    "remediation_notes": "This policy setting prevents users from changing their password multiple times in a short period to circumvent the password history policy. Setting it to '1 or more day(s)' ensures that a password cannot be changed immediately after being set. A value of '0' allows immediate password changes, which is generally not recommended for security.",
    "requires_reboot": false,
    "risk_level": "Medium"
  },
  "de246063-c947-42d6-8ac8-74835a2eb5c8": {
    "policy_id": "de246063-c947-42d6-8ac8-74835a2eb5c8",
    "policy_name": "Page 61 1.2.3 (L1) Ensure 'Allow Administrator account lockout' is set to",
    "registry_path": "N/A",
    "registry_hive": "N/A",
    "registry_key": "N/A",
    "registry_value_name": "N/A",
    "registry_value_type": "N/A",
    "enabled_value": "10",
    "disabled_value": "0",
    "gpo_path": null,
    "gpo_setting": null,
    "secedit_section": "System Access",
    "secedit_setting": "LockoutBadCount",
    "powershell_command": "net accounts /lockoutthreshold:10",
    "verification_command": "net accounts",
    "remediation_notes": "This password policy must be set via secedit or net accounts command. Registry modification is not supported.",
    "requires_reboot": false,
    "risk_level": "Medium"
  },
  "6f4b453c-cfc8-472e-8a82-c88bf7b31617": {
    "policy_id": "6f4b453c-cfc8-472e-8a82-c88bf7b31617",
    "policy_name": "Page 63 1.2.4 (L1) Ensure 'Reset account lockout counter after' is set to",
    "registry_path": "N/A",
    "registry_hive": "N/A",
    "registry_key": "N/A",
    "registry_value_name": "N/A",
    "registry_value_type": "N/A",
    "enabled_value": "10",
    "disabled_value": "0",
    "gpo_path": null,
    "gpo_setting": null,
    "secedit_section": "System Access",
    "secedit_setting": "LockoutBadCount",
    "powershell_command": "net accounts /lockoutthreshold:10",
    "verification_command": "net accounts",
    "remediation_notes": "This password policy must be set via secedit or net accounts command. Registry modification is not supported.",
    "requires_reboot": false,
    "risk_level": "Medium"
  },
  "5de04550-4aa9-4102-8e84-d1c2e89df561": {
    "policy_id": "5de04550-4aa9-4102-8e84-d1c2e89df561",
    "policy_name": "Page 39 1.1.1 (L1) Ensure 'Enforce password history' is set to '24 or more",
    "registry_path": "N/A:\\N/A",
    "registry_hive": "N/A",
    "registry_key": "N/A",
    "registry_value_name": "N/A",
    "registry_value_type": "N/A",
    "enabled_value": "24",
    "disabled_value": "0",
    "gpo_path": "Computer Configuration\\Windows Settings\\Security Settings\\Account Policies\\Password Policy",
    "gpo_setting": "Enforce password history",
    "secedit_section": "[System Access]",
    "secedit_setting": "PasswordHistorySize",
    "powershell_command": "net accounts /uniquepw:24",
    "verification_command": "(net accounts | Select-String -Pattern 'Minimum password history').ToString().Split(':')[1].Trim()",
    "remediation_notes": "This policy, when applied via 'net accounts' or local security policy (secedit), affects local user accounts on standalone systems or member servers not subject to a domain policy for this setting. For domain user accounts, password history is typically managed by the 'Default Domain Policy' GPO. Password Settings Objects (PSOs) can provide exceptions for specific domain users/groups. Microsoft's current maximum limit for password history is 24. To ensure effectiveness, it is critical to also configure a 'Minimum password age' to prevent users from rapidly cycling through passwords to reuse a previous one.",
    "requires_reboot": false,
    "risk_level": "Medium"
  },
  "b03809c4-1b17-4164-8cba-4da6531afdc0": {
    "policy_id": "b03809c4-1b17-4164-8cba-4da6531afdc0",
    "policy_name": "Page 3 1.1.3 (L1) Ensure 'Minimum password age' is set to '1 or more day(s)' (Automated)  ..............  44",
    "registry_path": "N/A:\\N/A",
    "registry_hive": "N/A",
    "registry_key": "N/A",
    "registry_value_name": "N/A",
    "registry_value_type": "N/A",
    "enabled_value": "1",
    "disabled_value": "0",
    "gpo_path": "Computer Configuration\\Windows Settings\\Security Settings\\Account Policies\\Password Policy",
    "gpo_setting": "Minimum password age",
    "secedit_section": "[System Access]",
    "secedit_setting": "MinimumPasswordAge",
    "powershell_command": "try {\n    # Define the content for the security template (.inf) file\n    $infContent = @'\n[Unicode]\nUnicode=yes\n[Version]\nsignature=\"$CHICAGO$\"\n\n[System Access]\nMinimumPasswordAge = 1\n'@\n\n    # Define paths for temporary files\n    $tempInfPath = Join-Path $env:TEMP \"cis_minpwage.inf\"\n    $tempSdbPath = Join-Path $env:TEMP \"cis_minpwage.sdb\"\n    $errorLogPath = Join-Path $env:TEMP \"cis_minpwage_error.log\"\n\n    # Write the security template content to a temporary .inf file\n    Set-Content -Path $tempInfPath -Value $infContent -Encoding ASCII\n\n    Write-Host \"Applying security policy 'Minimum password age' using secedit...\"\n    # Apply the security template using secedit\n    # /configure: Applies the security template\n    # /db: Specifies the security database file\n    # /cfg: Specifies the configuration file (.inf)\n    # /overwrite: Overwrites an existing database if it exists\n    # /areas SECURITYPOLICY: Configures the security policy area (includes account policies)\n    # /log: Specifies a log file for detailed output\n    $seceditResult = secedit /configure /db $tempSdbPath /cfg $tempInfPath /overwrite /areas SECURITYPOLICY /log $errorLogPath\n\n    # Check the exit code of secedit command\n    if ($LASTEXITCODE -eq 0) {\n        Write-Host \"Policy 'Minimum password age' successfully applied to '1 day(s)'.\"\n        # Force Group Policy update to ensure local policies are refreshed\n        gpupdate /force | Out-Null\n        Write-Host \"Group Policy update initiated to ensure changes are reflected.\"\n    } else {\n        Write-Warning \"Failed to apply policy using secedit. Exit code: $LASTEXITCODE.\"\n        Write-Warning \"Check log file for details: $errorLogPath\"\n        Get-Content $errorLogPath\n    }\n} catch {\n    Write-Error \"An error occurred during policy application: $($_.Exception.Message)\"\n} finally {\n    # Clean up temporary files\n    if (Test-Path $tempInfPath) { Remove-Item $tempInfPath -ErrorAction SilentlyContinue }\n    if (Test-Path $tempSdbPath) { Remove-Item $tempSdbPath -ErrorAction SilentlyContinue }\n    if (Test-Path $errorLogPath) { Remove-Item $errorLogPath -ErrorAction SilentlyContinue }\n}",
    "verification_command": "$minPwAge = (net accounts | Select-String \"Minimum password age\").ToString() | ForEach-Object { if ($_ -match 'Minimum password age:\\s+(\\d+)') { $Matches[1] } else { '' } }; if ($minPwAge -and ([int]$minPwAge -ge 1)) { Write-Host \"Minimum password age is set to $minPwAge day(s), which is compliant.\" } else { Write-Host \"Minimum password age is set to $minPwAge day(s) or not found, which is NOT compliant.\" }",
    "remediation_notes": "This policy ensures that a user cannot change their password within a specified period after setting or resetting it. The CIS benchmark requires this to be set to '1 or more day(s)' to prevent users from immediately circumventing password history policies (e.g., by changing a password multiple times to reuse an old one).\n\nThe `secedit` command, as implemented, applies this policy locally and persistently by modifying the local security database. For systems integrated into an Active Directory domain, Group Policy Objects (GPOs) are the authoritative method for setting such policies. For standalone systems, administrators can also configure this manually via the Local Security Policy editor (`secpol.msc`) by navigating to 'Security Settings' -> 'Account Policies' -> 'Password Policy' and modifying 'Minimum password age'.\n\nThe `net accounts` command provides a quick way to view the effective local account policies, which will reflect the `secedit` changes or any overriding GPO settings.",
    "requires_reboot": false,
    "risk_level": "Low"
  }
}